<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Perform overlap filtering of redundant tandem repeat annotations. &mdash; TRAL 0.3.5 documentation</title>
    
    <link rel="stylesheet" href="_static/tral.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.3.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="TRAL 0.3.5 documentation" href="index.html" />
    <link rel="next" title="Use GC3Pie to annotate your large sequence dataset." href="workflow.html" />
    <link rel="prev" title="Perform statistical significance test of tandem repeats." href="significance_test.html" />
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700|Source+Code+Pro|Armata|IM+Fell+English'
          rel='stylesheet' type='text/css' />
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script type="text/javascript">
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

  </head>
  <body role="document">
<div class="pageheader">
    <a href="http://www.isb-sib.ch/" class="sib_logo" title="SIB Swiss Institute of Bioinformatics"><img src="_static/sib.png" alt="SIB" class="sib_logo" /></a>
    <a href="index.html">
      <img class="headlogo" src="_static/trallogo.png" alt="TRAL" />
      <span class="headlogo">Tandem Repeat Annotation Library</span>
    </a>
    <div class="headlinks">
        <a href="index.html">Home</a>
        <a href="install.html">Install</a>
        <a href="code_docs.html">Code docs</a>
    </div>
</div>


      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Perform overlap filtering of redundant tandem repeat annotations.</a><ul>
<li><a class="reference internal" href="#read-in-tandem-repeat-annotations">Read in tandem repeat annotations.</a></li>
<li><a class="reference internal" href="#filter-overlapping-tandem-repeats">Filter overlapping tandem repeats.</a></li>
<li><a class="reference internal" href="#available-types-of-overlap-redundancy-detection">Available types of overlap/redundancy detection</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="significance_test.html"
                        title="previous chapter">Perform statistical significance test of tandem repeats.</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="workflow.html"
                        title="next chapter">Use GC3Pie to annotate your large sequence dataset.</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/overlap_filtering.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="perform-overlap-filtering-of-redundant-tandem-repeat-annotations">
<span id="overlap-filtering"></span><h1>Perform overlap filtering of redundant tandem repeat annotations.<a class="headerlink" href="#perform-overlap-filtering-of-redundant-tandem-repeat-annotations" title="Permalink to this headline">¶</a></h1>
<p>Here you learn how to detect tandem repeat annotations from multiple sources for different
types of overlap, and filter them accordingly.</p>
<p>Requirements for this tutorial:</p>
<ul class="simple">
<li><a class="reference internal" href="install.html#install"><span>Install TRAL</span></a>. TRAL ships with the tandem repeat data needed for this tutorial.</li>
<li><a class="reference internal" href="pvaluefiles.html#pvaluefiles"><span>Download p-Value distribution files</span></a>.</li>
</ul>
<div class="section" id="read-in-tandem-repeat-annotations">
<h2>Read in tandem repeat annotations.<a class="headerlink" href="#read-in-tandem-repeat-annotations" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">tral</span> <span class="kn">import</span> <span class="n">sequence</span>
<span class="kn">from</span> <span class="nn">tral.paths</span> <span class="kn">import</span> <span class="n">PACKAGE_DIRECTORY</span>

<span class="n">fRepeat_Pickle</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PACKAGE_DIRECTORY</span><span class="p">,</span> <span class="s2">&quot;examples&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;HIV-1_388796.pickle&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fRepeat_Pickle</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
    <span class="n">lHIV_Sequence</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="filter-overlapping-tandem-repeats">
<h2>Filter overlapping tandem repeats.<a class="headerlink" href="#filter-overlapping-tandem-repeats" title="Permalink to this headline">¶</a></h2>
<p>Tandem repeats can be clustered according to different types of overlap:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">overlap_type</span> <span class="o">=</span> <span class="s2">&quot;shared_char&quot;</span>
<span class="k">for</span> <span class="n">iSequence</span> <span class="ow">in</span> <span class="n">lHIV_Sequence</span><span class="p">:</span>
    <span class="n">iSequence</span><span class="o">.</span><span class="n">get_repeatlist</span><span class="p">(</span><span class="s2">&quot;denovo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">overlap_type</span><span class="p">)</span>
</pre></div>
</div>
<p>In the first sequences, no repeats share any chars, however in the second sequence, three tandem repeats
overlap:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">lHIV_Sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_repeatlist</span><span class="p">(</span><span class="s2">&quot;denovo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">d_cluster</span><span class="p">[</span><span class="n">overlap_type</span><span class="p">])</span>
<span class="go">[{5}, {4}, {3}, {2}, {1}, {0}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">lHIV_Sequence</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_repeatlist</span><span class="p">(</span><span class="s2">&quot;denovo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">d_cluster</span><span class="p">[</span><span class="n">overlap_type</span><span class="p">])</span>
<span class="go">[{4, 5}, {0, 2, 3}, {1}]</span>
</pre></div>
</div>
<p>Tandem repeats can also directly be filtered of overlapping tandem repeats. Here, we need
to choose to retain one of the overlapping tandem repeats. For example the following code snippet
will first retain the tandem repeats with the lowest p-value according to the <em>score</em>, and in case
there are still draws, retain the tandem repeat of lowest divergence:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">overlap_type</span> <span class="o">=</span> <span class="s2">&quot;common_ancestry&quot;</span>
<span class="n">score</span> <span class="o">=</span> <span class="s2">&quot;phylo_gap001&quot;</span>
<span class="k">for</span> <span class="n">iSequence</span> <span class="ow">in</span> <span class="n">lHIV_Sequence</span><span class="p">:</span>
    <span class="n">repeat_list_filtered</span> <span class="o">=</span> <span class="n">iSequence</span><span class="o">.</span><span class="n">get_repeatlist</span><span class="p">(</span><span class="s2">&quot;denovo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;none_overlapping&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">overlap_type</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">[(</span><span class="s2">&quot;pvalue&quot;</span><span class="p">,</span> <span class="n">score</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;divergence&quot;</span><span class="p">,</span> <span class="n">score</span><span class="p">)])</span>
    <span class="n">iSequence</span><span class="o">.</span><span class="n">set_repeatlist</span><span class="p">(</span><span class="n">repeat_list_filtered</span><span class="p">,</span> <span class="s2">&quot;denovo_non_overlapping&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting <em>result_list</em> now only contains tandem repeats that do not overlap according
the <em>common ancestry</em> overlap:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">([</span><span class="n">iR</span> <span class="k">for</span> <span class="n">iS</span> <span class="ow">in</span> <span class="n">lHIV_Sequence</span> <span class="k">for</span> <span class="n">iR</span> <span class="ow">in</span> <span class="n">iS</span><span class="o">.</span><span class="n">get_repeatlist</span><span class="p">(</span><span class="s2">&quot;denovo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">repeats</span><span class="p">])</span>
<span class="go">28</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">([</span><span class="n">iR</span> <span class="k">for</span> <span class="n">iS</span> <span class="ow">in</span> <span class="n">lHIV_Sequence</span> <span class="k">for</span> <span class="n">iR</span> <span class="ow">in</span> <span class="n">iS</span><span class="o">.</span><span class="n">get_repeatlist</span><span class="p">(</span><span class="s2">&quot;denovo_non_overlapping&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">repeats</span><span class="p">])</span>
<span class="go">23</span>
</pre></div>
</div>
</div>
<div class="section" id="available-types-of-overlap-redundancy-detection">
<h2>Available types of overlap/redundancy detection<a class="headerlink" href="#available-types-of-overlap-redundancy-detection" title="Permalink to this headline">¶</a></h2>
<p>There are currently two types of overlap implemented:</p>
<ul class="simple">
<li>&#8220;shared_char&#8221;: Do two tandem repeats contain any two chars in common?</li>
<li>&#8220;common ancestry&#8221;: Do two tandem repeats have at least two chars in the same column of their tandem repeat unit alignments? This approach is more conservative than &#8220;shared char&#8221;. This approach has been used in the <a class="reference internal" href="contributors.html#publications"><span>MBE and New Phytologist publications, 2014</span></a>.</li>
</ul>
<p>For clustering, overlap is assumed to be a transitive attribute. That is, if tandem repeats
A &amp; B, as well as B &amp; C overlap, all tandem repeats A, B &amp; C are clustered, no matter
whether A and C do also overlap.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>


  </body>
</html>