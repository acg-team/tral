
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Searching for particular repeats &#8212; TRAL 2.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/tral.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Running TRAL using vagrant" href="vagrant.html" />
    <link rel="prev" title="Use GC3Pie to annotate your large sequence dataset." href="workflow.html" />
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700|Source+Code+Pro|Armata|IM+Fell+English'
          rel='stylesheet' type='text/css' />
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script type="text/javascript">
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

  </head><body>
<div class="pageheader">
    <a href="http://www.isb-sib.ch/" class="sib_logo" title="SIB Swiss Institute of Bioinformatics"><img src="_static/sib.png" alt="SIB" class="sib_logo" /></a>
    <a href="index.html">
      <img class="headlogo" src="_static/trallogo.png" alt="TRAL" />
      <span class="headlogo">Tandem Repeat Annotation Library</span>
    </a>
    <div class="headlinks">
        <a href="index.html">Home</a>
        <a href="install.html">Install</a>
        <a href="code_docs.html">Code docs</a>
    </div>
</div>


      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Searching for particular repeats</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#id1">search_hmm</a><ul>
<li><a class="reference internal" href="#full-usage">Full usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#filter-hmm">filter_hmm</a><ul>
<li><a class="reference internal" href="#id2">Full usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python-api">Python API</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="workflow.html"
                          title="previous chapter">Use GC3Pie to annotate your large sequence dataset.</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="vagrant.html"
                          title="next chapter">Running TRAL using vagrant</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/search_hmm.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="searching-for-particular-repeats">
<span id="search-hmm"></span><h1>Searching for particular repeats<a class="headerlink" href="#searching-for-particular-repeats" title="Permalink to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>The search package provides python modules and command line tools for identifying
tandem repeats in sequence databases. Typically processing consists of first
running <code class="docutils literal notranslate"><span class="pre">search_hmm</span></code> to identify instances of a query repeat
in a sequence database. This is relatively slow (hours to days
against Uniprot) but can be trivially parallelized to run on a cluster.</p>
<p>After scoring the hmm against every sequence in the database, <code class="docutils literal notranslate"><span class="pre">filter_hmm</span></code> is
used to identify significant results.</p>
</section>
<section id="id1">
<h2>search_hmm<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
<p>The search module can be run directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">tral</span><span class="o">.</span><span class="n">search</span><span class="o">.</span><span class="n">search_hmm</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>The query HMM should be in HMMR format. The <code class="docutils literal notranslate"><span class="pre">hmmbuild</span></code> tool may be helpful for
generating HMM files from multiple alignments. The HMM should represent a single
repeat. Circularly permuted edges are automatically inserted to permit multiple
sequential repeats.</p>
<p>The database should be in FASTA format. It may be gzip compressed.</p>
<p>Results are produced in TSV format, and include</p>
<ul class="simple">
<li><p>Sequence identifier (header line from FASTA file)</p></li>
<li><p>Viterbi probability (probability that this sequence was emitted by the query
HMM)</p></li>
<li><p>Log-odds ratio (viterbi probability divided by the expected probability for
a sequence of this length</p></li>
<li><p>HMM states (Maximum likelihood sequence of states through the HMM, as
determined by the Viiterbi algorithm</p></li>
</ul>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">tral</span><span class="o">.</span><span class="n">search</span><span class="o">.</span><span class="n">search_hmm</span> <span class="n">query</span><span class="o">.</span><span class="n">hmm</span> <span class="n">database</span><span class="o">.</span><span class="n">faa</span><span class="o">.</span><span class="n">gz</span> <span class="n">results</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
<p>When running on a cluster, it may be useful to search just a subset of the
database. For instance, here’s a simplified submission script using the <code class="docutils literal notranslate"><span class="pre">-n</span></code>
and <code class="docutils literal notranslate"><span class="pre">-s</span></code> parameters in an array job:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
#BSUB -J tral[1-10]
n=1000
start=$(( (${LSB_JOBINDEX:-1}-1) * $n ))
python -m tral.search.tral_search \
    -n $n -s $start \
    query.hmm database.fasta.gz results.${LSB_JOBINDEX:-1}.tsv
</pre></div>
</div>
<p>Choosing an appropriate log-odds ratio depends on the database size, amino
acid content, HMM length, and HMM composition. To help calibrate this, the <code class="docutils literal notranslate"><span class="pre">-r</span></code>
option is available to automatically shuffle the input sequences. The results
then represent all negative hits, allowing the False Discovery Rate to be
estimated for various thresholds in the filtering step.</p>
<section id="full-usage">
<h3>Full usage<a class="headerlink" href="#full-usage" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">search_hmm</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span> <span class="n">START</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">n</span> <span class="n">DBSIZE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">r</span><span class="p">]</span>
                    <span class="n">hmm</span> <span class="n">database</span> <span class="n">results</span>

<span class="n">Align</span> <span class="n">a</span> <span class="n">cpHMM</span> <span class="n">against</span> <span class="n">a</span> <span class="n">database</span> <span class="n">using</span> <span class="n">TRAL</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
<span class="n">hmm</span>                   <span class="n">cpHMM</span> <span class="n">filename</span>
<span class="n">database</span>              <span class="n">database</span> <span class="n">to</span> <span class="n">search</span><span class="p">,</span> <span class="ow">in</span> <span class="n">fasta</span> <span class="nb">format</span> <span class="p">(</span><span class="n">may</span> <span class="n">be</span> <span class="n">gzip</span>
                        <span class="n">compressed</span><span class="p">)</span>
<span class="n">results</span>               <span class="n">results</span> <span class="n">file</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
<span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
<span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">Long</span> <span class="n">messages</span>
<span class="o">-</span><span class="n">s</span> <span class="n">START</span><span class="p">,</span> <span class="o">--</span><span class="n">start</span> <span class="n">START</span>
                        <span class="n">Index</span> <span class="n">of</span> <span class="n">database</span> <span class="n">sequence</span> <span class="n">to</span> <span class="n">start</span> <span class="k">with</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
<span class="o">-</span><span class="n">n</span> <span class="n">DBSIZE</span><span class="p">,</span> <span class="o">--</span><span class="n">dbsize</span> <span class="n">DBSIZE</span>
                        <span class="n">Number</span> <span class="n">of</span> <span class="n">database</span> <span class="n">sequences</span> <span class="n">to</span> <span class="n">include</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="mi">0</span> <span class="n">to</span>
                        <span class="n">include</span> <span class="nb">all</span><span class="p">)</span>
<span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="o">--</span><span class="n">shuffle</span>         <span class="n">Shuffle</span> <span class="n">database</span> <span class="n">sequences</span>
</pre></div>
</div>
</section>
</section>
<section id="filter-hmm">
<h2>filter_hmm<a class="headerlink" href="#filter-hmm" title="Permalink to this heading">¶</a></h2>
<p>The results from <code class="docutils literal notranslate"><span class="pre">search_hmm</span></code> include both significant and insignificant hits.
Use <code class="docutils literal notranslate"><span class="pre">filter_hmm</span></code> to filter the results based on length and log-odds criteria.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">tral</span><span class="o">.</span><span class="n">search</span><span class="o">.</span><span class="n">filter_hmm</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p><strong>Output</strong>. The tool can produce three kinds of output:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span></code> <strong>FASTA</strong>: Subset of the input database corresponding to significant hits</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-o</span></code> <strong>TSV</strong>: Subset of the <code class="docutils literal notranslate"><span class="pre">search_hmm</span></code> results corresponding to
significant hits</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-x</span></code> <strong>TREKS</strong>: All significant repeats in T-REKS format.</p></li>
</ul>
<p>The TREKS format is most useful for exporting results to other programs.</p>
<p><strong>Identifiers</strong>. By default, the identifier is extracted from the database
header lines (e.g. <code class="docutils literal notranslate"><span class="pre">&gt;tr|id|description...</span></code>). For compatibility with other
programs, the <code class="docutils literal notranslate"><span class="pre">--preserve-header</span></code> option can also be used to match sequences
based on the full header.</p>
<p><strong>Thresholds</strong>. Thresholds can be set for either:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-r</span></code> <strong>Number of repeats</strong> (float). Repeats are computed based on the HMM match
states. This means that partial repeats are counted as a fraction of the
query length.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-t</span></code> <strong>Log-odds threshold</strong> (float). Results with log-odds less than this value
are filtered out.</p></li>
</ul>
<p><strong>Memory usage</strong>. Memory usage should be low if a single output is used. If
several output options are selected then the significant hits are stored in
memory. If this is problematic, <code class="docutils literal notranslate"><span class="pre">filter_hmm</span></code> can be run separately for
each desired output.</p>
<p><strong>Example:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">tral</span><span class="o">.</span><span class="n">search</span><span class="o">.</span><span class="n">filter_hmm</span> \
    <span class="o">-</span><span class="n">f</span> <span class="n">filtered</span><span class="o">.</span><span class="n">faa</span> \
    <span class="o">-</span><span class="n">o</span> <span class="n">filtered</span><span class="o">.</span><span class="n">tsv</span> \
    <span class="o">-</span><span class="n">x</span> <span class="n">filtered</span><span class="o">.</span><span class="n">tdr</span> \
    <span class="o">-</span><span class="n">r</span> <span class="mi">2</span> <span class="o">-</span><span class="n">t</span> <span class="mf">8.0</span> \
    <span class="n">results</span><span class="o">.</span><span class="n">tsv</span> <span class="n">database</span><span class="o">.</span><span class="n">faa</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<section id="id2">
<h3>Full usage<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">filter_hmm</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span> <span class="n">FILTERED_FASTA</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="n">FILTERED_TSV</span><span class="p">]</span>
                    <span class="p">[</span><span class="o">-</span><span class="n">x</span> <span class="n">FILTERED_TREKS</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">r</span> <span class="n">MIN_REPEATS</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">t</span> <span class="n">LOG_ODDS</span><span class="p">]</span>
                    <span class="p">[</span><span class="o">--</span><span class="n">preserve</span><span class="o">-</span><span class="n">header</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">]</span>
                    <span class="n">hits</span> <span class="n">database</span>

<span class="n">Filter</span> <span class="n">hits</span> <span class="kn">from</span> <span class="nn">search_hmm</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
<span class="n">hits</span>                  <span class="n">TSV</span> <span class="n">file</span><span class="p">,</span> <span class="k">as</span> <span class="n">produced</span> <span class="n">by</span> <span class="n">search_hmm</span><span class="p">,</span> <span class="n">containing</span> <span class="n">HMM</span>
                        <span class="n">hits</span>
<span class="n">database</span>              <span class="n">database</span> <span class="n">to</span> <span class="nb">filter</span><span class="p">,</span> <span class="ow">in</span> <span class="n">fasta</span> <span class="nb">format</span> <span class="p">(</span><span class="n">may</span> <span class="n">be</span> <span class="n">gzip</span>
                        <span class="n">compressed</span><span class="p">)</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
<span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
<span class="o">--</span><span class="n">preserve</span><span class="o">-</span><span class="n">header</span>     <span class="n">Include</span> <span class="n">the</span> <span class="n">full</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">FASTA</span> <span class="n">output</span><span class="o">.</span> <span class="n">Otherwise</span><span class="p">,</span>
                        <span class="n">just</span> <span class="n">the</span> <span class="n">identifier</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">to</span> <span class="n">match</span> <span class="n">TSV</span> <span class="ow">and</span> <span class="n">TREKS</span><span class="o">.</span>
<span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>         <span class="n">Long</span> <span class="n">messages</span>

<span class="n">outputs</span><span class="p">:</span>
<span class="o">-</span><span class="n">f</span> <span class="n">FILTERED_FASTA</span><span class="p">,</span> <span class="o">--</span><span class="n">filtered</span><span class="o">-</span><span class="n">fasta</span> <span class="n">FILTERED_FASTA</span>
                        <span class="n">output</span> <span class="n">fasta</span> <span class="n">file</span><span class="p">,</span> <span class="n">filtered</span> <span class="n">by</span> <span class="n">hits</span>
<span class="o">-</span><span class="n">o</span> <span class="n">FILTERED_TSV</span><span class="p">,</span> <span class="o">--</span><span class="n">filtered</span><span class="o">-</span><span class="n">tsv</span> <span class="n">FILTERED_TSV</span>
                        <span class="n">Filtered</span> <span class="n">TSV</span> <span class="n">file</span>
<span class="o">-</span><span class="n">x</span> <span class="n">FILTERED_TREKS</span><span class="p">,</span> <span class="o">--</span><span class="n">filtered</span><span class="o">-</span><span class="n">treks</span> <span class="n">FILTERED_TREKS</span>
                        <span class="n">Filtered</span> <span class="n">T</span><span class="o">-</span><span class="n">Reks</span> <span class="n">file</span>

<span class="n">Thresholds</span><span class="p">:</span>
<span class="o">-</span><span class="n">r</span> <span class="n">MIN_REPEATS</span><span class="p">,</span> <span class="o">--</span><span class="nb">min</span><span class="o">-</span><span class="n">repeats</span> <span class="n">MIN_REPEATS</span>
                        <span class="n">Minimum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">repeats</span>
<span class="o">-</span><span class="n">t</span> <span class="n">LOG_ODDS</span><span class="p">,</span> <span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">odds</span> <span class="n">LOG_ODDS</span>
                        <span class="n">Threshold</span> <span class="k">for</span> <span class="n">minimum</span> <span class="n">log</span><span class="o">-</span><span class="n">odds</span> <span class="n">ratio</span>
</pre></div>
</div>
</section>
</section>
<section id="python-api">
<h2>Python API<a class="headerlink" href="#python-api" title="Permalink to this heading">¶</a></h2>
<p>See also the <a class="reference internal" href="tral/hmm.html"><span class="doc">Search code documentation</span></a></p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>


  </body>
</html>